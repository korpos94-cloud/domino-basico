<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Domin√≥ - Juego Profesional</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json" />
    <meta name="theme-color" content="#00b894" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Domin√≥" />
    <meta name="description" content="Juego de domin√≥ profesional contra IA con 3 niveles de dificultad" />

    <!-- Estilos CSS en orden correcto -->
    <link rel="stylesheet" href="src/css/layout.css" />
    <link rel="stylesheet" href="src/css/tiles.css" />
    <link rel="stylesheet" href="src/css/tiles-states.css" />

    <!-- Fuente moderna -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <style>
      /* Reset b√°sico */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
        overflow: hidden;
        font-family: 'Inter', sans-serif;
      }

      /* Variables de color */
      :root {
        --primary-color: #3b82f6;
        --secondary-color: #8b5cf6;
        --success-color: #00b894;
        --danger-color: #ef4444;
        --warning-color: #f59e0b;
        --dark-bg: #1a2980;
        --card-bg: #16213e;
        --border-color: #334155;
        --text-primary: #f8fafc;
        --text-secondary: #94a3b8;
      }

      /* Fondo general */
      body {
        background: linear-gradient(135deg, #1a2980 0%, #26d0ce 100%);
        color: var(--text-primary);
      }
    </style>
  </head>
  <body>
    <!-- Contenedor principal del juego -->
    <div class="game-container" id="gameContainer">
      <!-- Zona 1: Mano de la IA -->
      <section class="ai-hand-area" id="aiHandArea">
        <div class="hand-header">
          <h3 class="hand-title">ü§ñ Oponente (IA)</h3>
          <div class="hand-count" id="opponentCount">7 fichas</div>
        </div>
        <div class="hand-content" id="opponentHand">
          <!-- Las fichas de la IA se renderizar√°n aqu√≠ -->
        </div>
      </section>

      <!-- Zona 2: Mesa de juego -->
      <section class="board-area" id="boardArea">
        <div class="board-header">
          <h2 class="board-title">üé≤ Mesa de Domin√≥</h2>
          <div class="board-stats">
            <span class="stat-item" id="boardCount">0 fichas</span>
            <span class="stat-item" id="turnIndicator">Turno: Jugador</span>
          </div>
        </div>
        <div class="board-content">
          <div id="gameBoard">
            <!-- Las fichas de la mesa se renderizar√°n aqu√≠ -->
            <div class="empty-board-message" id="emptyBoard">
              <div class="empty-icon">üé¥</div>
              <p>Coloca la primera ficha para comenzar</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Zona 3: Mano del jugador -->
      <section class="player-hand-area" id="playerHandArea">
        <div class="hand-header">
          <h3 class="hand-title">üë§ Tu Mano</h3>
          <div class="hand-count" id="playerCount">7 fichas</div>
        </div>
        <div class="hand-content" id="playerHand">
          <!-- Las fichas del jugador se renderizar√°n aqu√≠ -->
        </div>
      </section>

      <!-- Zona 4: Panel de control -->
      <footer class="control-panel" id="controlPanel">
        <!-- Configuraci√≥n de dificultad -->
        <div class="difficulty-config">
          <label for="difficultySelect" class="difficulty-label">Dificultad IA:</label>
          <select id="difficultySelect" class="difficulty-select" onchange="handleDifficultyChange(this.value)">
            <option value="easy">F√°cil</option>
            <option value="medium" selected>Medio</option>
            <option value="hard">Dif√≠cil</option>
          </select>
        </div>

        <!-- Botones de acci√≥n -->
        <div class="control-buttons">
          <button class="control-btn btn-draw" id="btn-draw" onclick="handleDrawTile()">
            <span class="btn-icon">üé¥</span>
            <span class="btn-text">Robar</span>
          </button>

          <button class="control-btn btn-pass" id="btn-pass" onclick="handlePassTurn()">
            <span class="btn-icon">‚è≠Ô∏è</span>
            <span class="btn-text">Pasar</span>
          </button>

          <button class="control-btn btn-hint" id="btn-hint" onclick="handleHint()">
            <span class="btn-icon">üí°</span>
            <span class="btn-text">Pista</span>
          </button>

          <button class="control-btn btn-restart" id="btn-restart" onclick="handleNewGame()">
            <span class="btn-icon">üîÑ</span>
            <span class="btn-text">Reiniciar</span>
          </button>
        </div>

        <!-- Estad√≠sticas del juego -->
        <div class="game-stats" id="gameStats">
          <div class="stat-row">
            <div class="stat-item">
              <span class="stat-label">Ronda</span>
              <span class="stat-value" id="roundNumber">1</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Pozo</span>
              <span class="stat-value" id="stockCount">14</span>
            </div>
          </div>
          <div class="stat-row">
            <div class="stat-item player-score">
              <span class="stat-label">Tus puntos</span>
              <span class="stat-value" id="playerScore">0</span>
            </div>
            <div class="stat-item opponent-score">
              <span class="stat-label">IA puntos</span>
              <span class="stat-value" id="opponentScore">0</span>
            </div>
          </div>
        </div>
      </footer>
    </div>

    <!-- Canvas de confetti para celebraciones -->
    <canvas id="confettiCanvas"></canvas>

    <!-- Modal overlay -->
    <div class="modal-overlay" id="modalOverlay">
      <div class="modal-container" id="modalContainer">
        <div class="modal-header">
          <h2 class="modal-title" id="modalTitle">T√≠tulo</h2>
          <button class="modal-close" id="modalClose" onclick="hideGameModal()">
            <span aria-hidden="true">‚úï</span>
          </button>
        </div>
        <div class="modal-body" id="modalBody">
          <p>Contenido del modal</p>
        </div>
        <div class="modal-footer" id="modalFooter">
          <button class="modal-btn btn-primary" id="modalPrimaryBtn" onclick="hideGameModal()">
            Aceptar
          </button>
        </div>
      </div>
    </div>

    <!-- Scripts del juego -->
    <script type="module">
      // Importar m√≥dulos existentes
      import {
        initGame,
        playerPlay,
        playerDrawTile,
        playerPassTurn,
        aiPlay,
        getGameState,
        restartGame,
        resetGame,
        getCurrentPlayerPlayableTiles,
        changeAIDifficulty
      } from './src/js/game.js'
      import { initUI, updateUI, showMessage, highlightPlayableTiles, showModal, hideModal, showVictoryModal, showBlockedModal } from './src/js/ui.js'
      import { initAudio, getAudioManager } from './src/js/audio.js'
      import { initConfetti, launchConfetti, confettiBurst } from './src/js/confetti.js'

      // Variables globales para acceso desde HTML
      window.handleTileClick = handleTileClick
      window.handleDrawTile = handleDrawTile
      window.handlePassTurn = handlePassTurn
      window.handleHint = handleHint
      window.handleNewGame = handleNewGame
      window.handleResetGame = handleResetGame
      window.handleDifficultyChange = handleDifficultyChange
      window.hideGameModal = hideModal

      // Estado del juego
      let gameInterval = null
      let audioManager = null

      // Inicializar cuando se carga la p√°gina
      document.addEventListener('DOMContentLoaded', () => {
        console.log('üéÆ Iniciando Domin√≥...')

        // Inicializar audio
        audioManager = initAudio()

        // Inicializar confetti
        initConfetti()

        // Inicializar UI con referencias DOM actualizadas
        initUI({
          board: document.getElementById('gameBoard'),
          playerHand: document.getElementById('playerHand'),
          opponentHand: document.getElementById('opponentHand'),
          stock: null,
          message: null,
          stats: document.getElementById('gameStats'),
          currentPlayer: document.getElementById('turnIndicator'),
          playerScore: document.getElementById('playerScore'),
          opponentScore: document.getElementById('opponentScore')
        })

        // Iniciar nueva partida
        handleNewGame()

        // Iniciar intervalo para actualizaciones
        gameInterval = setInterval(updateGameState, 1000)

        // Configurar escalado autom√°tico en redimensionamiento
        window.addEventListener('resize', autoScale)
        autoScale()

        // Registrar Service Worker para PWA
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.register('./service-worker.js')
            .then((registration) => {
              console.log('‚úÖ Service Worker registrado:', registration.scope)
            })
            .catch((error) => {
              console.warn('‚ö†Ô∏è Error registrando Service Worker:', error)
            })
        }

        console.log('‚úÖ Juego inicializado')
      })

      // Event listener para nueva partida desde modal
      document.addEventListener('newGameRequested', () => {
        console.log('üéÆ Nueva partida solicitada desde modal')
        handleNewGame()
      })

      // Funci√≥n de escalado autom√°tico
      function autoScale() {
        const w = window.innerWidth
        const gameState = getGameState()

        if (gameState && gameState.options) {
          if (w < 500) {
            gameState.options.width = 50
            gameState.options.height = 100
          } else if (w < 900) {
            gameState.options.width = 70
            gameState.options.height = 140
          } else {
            gameState.options.width = 90
            gameState.options.height = 180
          }

          if (gameState.phase === 'playing') {
            updateUI()
          }
        }
      }

      // Manejar clic en ficha del jugador
      // CORREGIDO: Gesti√≥n de selecci√≥n de lado
      function handleTileClick(tileId) {
        const gameState = getGameState()
        if (!gameState || gameState.phase !== 'playing' || gameState.currentPlayer !== 'player') {
          showHintTooltip('No es tu turno', 'warning', 2000)
          audioManager?.playSFX('invalid')
          return
        }

        const playableTiles = getCurrentPlayerPlayableTiles()
        const playableInfo = playableTiles.find(p => p.tile.id === tileId)

        if (!playableInfo) {
          showHintTooltip('Esta ficha no se puede jugar ahora', 'error', 2500)
          audioManager?.playSFX('invalid')
          return
        }

        // Sonido de click
        audioManager?.playSFX('click')

        // Si es la primera ficha de la mesa, colocar autom√°ticamente sin preguntar
        if (gameState.board.tiles.length === 0) {
          const side = playableInfo.sides[0] // Usar el primer lado disponible
          const success = playerPlay(tileId, side)

          if (success) {
            audioManager?.playSFX('place')
            updateUI()

            setTimeout(() => {
              if (getGameState()?.currentPlayer === 'opponent') {
                aiPlay()
                audioManager?.playSFX('place')
                updateUI()
              }
            }, 1000)
          }
          return
        }

        // Si la ficha puede jugarse en ambos lados, pedir confirmaci√≥n
        if (playableInfo.sides.length > 1) {
          showSideSelectionDialog(tileId)
          return
        }

        // Si solo hay un lado disponible, jugar autom√°ticamente
        const side = playableInfo.sides[0]
        const success = playerPlay(tileId, side)

        if (success) {
          audioManager?.playSFX('place')
          updateUI()

          setTimeout(() => {
            if (getGameState()?.currentPlayer === 'opponent') {
              aiPlay()
              audioManager?.playSFX('place')
              updateUI()
            }
          }, 1000)
        }
      }

      // Mostrar di√°logo de selecci√≥n de lado
      function showSideSelectionDialog(tileId) {
        const overlay = document.createElement('div')
        overlay.id = 'side-selection-overlay'
        overlay.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: rgba(0, 0, 0, 0.7);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 9999;
        `

        const dialog = document.createElement('div')
        dialog.style.cssText = `
          background: #1e293b;
          padding: 30px;
          border-radius: 16px;
          text-align: center;
          box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
          max-width: 400px;
        `

        dialog.innerHTML = `
          <h3 style="color: #f8fafc; margin-bottom: 20px; font-size: 1.2rem;">
            ¬øEn qu√© lado quieres jugar la ficha?
          </h3>
          <div style="display: flex; gap: 15px; justify-content: center;">
            <button id="btn-left" style="
              padding: 15px 30px;
              background: linear-gradient(135deg, #10b981, #059669);
              color: white;
              border: none;
              border-radius: 10px;
              font-size: 1rem;
              font-weight: 600;
              cursor: pointer;
              transition: transform 0.2s;
            ">
              ‚¨ÖÔ∏è Izquierda
            </button>
            <button id="btn-right" style="
              padding: 15px 30px;
              background: linear-gradient(135deg, #ef4444, #dc2626);
              color: white;
              border: none;
              border-radius: 10px;
              font-size: 1rem;
              font-weight: 600;
              cursor: pointer;
              transition: transform 0.2s;
            ">
              Derecha ‚û°Ô∏è
            </button>
          </div>
          <button id="btn-cancel" style="
            margin-top: 15px;
            padding: 10px 20px;
            background: transparent;
            color: #94a3b8;
            border: 1px solid #475569;
            border-radius: 8px;
            cursor: pointer;
          ">
            Cancelar
          </button>
        `

        overlay.appendChild(dialog)
        document.body.appendChild(overlay)

        // Event listeners
        document.getElementById('btn-left').onclick = () => {
          document.body.removeChild(overlay)
          const success = playerPlay(tileId, 'left')
          if (success) {
            showMessage('Jugaste la ficha en izquierda', 'success')
            updateUI()
            setTimeout(() => {
              if (getGameState()?.currentPlayer === 'opponent') {
                aiPlay()
                updateUI()
              }
            }, 1000)
          }
        }

        document.getElementById('btn-right').onclick = () => {
          document.body.removeChild(overlay)
          const success = playerPlay(tileId, 'right')
          if (success) {
            showMessage('Jugaste la ficha en derecha', 'success')
            updateUI()
            setTimeout(() => {
              if (getGameState()?.currentPlayer === 'opponent') {
                aiPlay()
                updateUI()
              }
            }, 1000)
          }
        }

        document.getElementById('btn-cancel').onclick = () => {
          document.body.removeChild(overlay)
        }

        // Hover effects
        const buttons = dialog.querySelectorAll('button:not(#btn-cancel)')
        buttons.forEach(btn => {
          btn.onmouseenter = () => btn.style.transform = 'scale(1.05)'
          btn.onmouseleave = () => btn.style.transform = 'scale(1)'
        })
      }

      // Manejar robo de ficha
      // CORREGIDO: Respeta nuevo flujo de turnos
      function handleDrawTile() {
        const gameState = getGameState()
        if (!gameState || gameState.currentPlayer !== 'player') {
          showHintTooltip('No puedes robar ahora', 'warning', 2000, document.getElementById('btn-draw'))
          audioManager?.playSFX('invalid')
          return
        }

        if (gameState.stock.length === 0) {
          showHintTooltip('El pozo est√° vac√≠o', 'warning', 2000, document.getElementById('btn-draw'))
          audioManager?.playSFX('invalid')
          return
        }

        const drawnTile = playerDrawTile()
        if (drawnTile) {
          audioManager?.playSFX('draw')
          const playableTiles = getCurrentPlayerPlayableTiles()

          if (playableTiles.length > 0) {
            showHintTooltip('Robaste una ficha. Puedes jugar.', 'success', 2500)
          } else {
            showHintTooltip('Robaste una ficha. No puedes jugar, turno pasado.', 'info', 2500)
            audioManager?.playSFX('pass')
          }

          updateUI()

          // Solo ejecutar turno de IA si cambi√≥ el turno
          setTimeout(() => {
            if (getGameState()?.currentPlayer === 'opponent') {
              aiPlay()
              audioManager?.playSFX('place')
              updateUI()
            }
          }, 1000)
        }
      }

      // Manejar pasar turno
      // CORREGIDO: Usa nueva funci√≥n playerPassTurn()
      function handlePassTurn() {
        const gameState = getGameState()
        if (!gameState || gameState.currentPlayer !== 'player') {
          showMessage('No es tu turno', 'warning')
          audioManager?.playSFX('invalid')
          return
        }

        const success = playerPassTurn()

        if (success) {
          audioManager?.playSFX('pass')
          showMessage('Pasaste turno', 'info')
          updateUI()

          setTimeout(() => {
            if (getGameState()?.currentPlayer === 'opponent') {
              aiPlay()
              audioManager?.playSFX('place')
              updateUI()
            }
          }, 1000)
        } else {
          const playableTiles = getCurrentPlayerPlayableTiles()
          if (playableTiles.length > 0) {
            showHintTooltip('Tienes fichas jugables', 'warning', 2500, document.getElementById('btn-pass'))
            audioManager?.playSFX('invalid')
          } else if (gameState.stock.length > 0) {
            showHintTooltip('Debes robar del pozo primero', 'warning', 2500, document.getElementById('btn-draw'))
            audioManager?.playSFX('invalid')
          }
        }
      }

      // Sistema de Tooltips/Globos para Pistas
      let currentTooltip = null
      let tooltipTimeout = null

      function showHintTooltip(message, type = 'info', duration = 3000, targetElement = null) {
        // Ocultar tooltip anterior si existe
        hideHintTooltip()

        // Crear tooltip
        const tooltip = document.createElement('div')
        tooltip.className = `hint-tooltip ${type}`

        // Iconos seg√∫n el tipo
        const icons = {
          info: 'üí°',
          error: '‚ùå',
          warning: '‚ö†Ô∏è',
          success: '‚úÖ'
        }

        tooltip.innerHTML = `
          <span class="hint-icon">${icons[type] || icons.info}</span>
          <span>${message}</span>
          <button class="hint-close" onclick="hideHintTooltip()">‚úï</button>
        `

        document.body.appendChild(tooltip)
        currentTooltip = tooltip

        // Posicionar tooltip
        const targetEl = targetElement || document.querySelector('.control-buttons')
        if (targetEl) {
          const rect = targetEl.getBoundingClientRect()
          const tooltipRect = tooltip.getBoundingClientRect()

          // Centrar horizontalmente sobre el elemento
          let left = rect.left + (rect.width / 2) - (tooltipRect.width / 2)
          let top = rect.top - tooltipRect.height - 16

          // Ajustar si se sale de la pantalla
          if (left < 10) left = 10
          if (left + tooltipRect.width > window.innerWidth - 10) {
            left = window.innerWidth - tooltipRect.width - 10
          }

          // Si no hay espacio arriba, mostrar abajo
          if (top < 10) {
            top = rect.bottom + 16
            tooltip.classList.add('position-top')
          }

          tooltip.style.left = `${left}px`
          tooltip.style.top = `${top}px`
        } else {
          // Centrar en pantalla si no hay elemento objetivo
          tooltip.style.left = '50%'
          tooltip.style.top = '50%'
          tooltip.style.transform = 'translate(-50%, -50%)'
        }

        // Mostrar con animaci√≥n
        setTimeout(() => tooltip.classList.add('show'), 10)

        // Reproducir sonido
        if (audioManager) {
          if (type === 'error') audioManager.playSFX('invalid')
          else if (type === 'success') audioManager.playSFX('place')
          else audioManager.playSFX('click')
        }

        // Auto-ocultar despu√©s de la duraci√≥n
        if (duration > 0) {
          tooltipTimeout = setTimeout(() => hideHintTooltip(), duration)
        }
      }

      function hideHintTooltip() {
        if (tooltipTimeout) {
          clearTimeout(tooltipTimeout)
          tooltipTimeout = null
        }

        if (currentTooltip) {
          currentTooltip.classList.remove('show')
          setTimeout(() => {
            if (currentTooltip) {
              currentTooltip.remove()
              currentTooltip = null
            }
          }, 300)
        }
      }

      // Hacer hideHintTooltip global para el bot√≥n de cerrar
      window.hideHintTooltip = hideHintTooltip

      // Mostrar pista
      function handleHint() {
        const gameState = getGameState()
        if (!gameState || gameState.currentPlayer !== 'player') {
          showHintTooltip('No es tu turno', 'warning', 2000)
          return
        }

        const playableTiles = getCurrentPlayerPlayableTiles()
        if (playableTiles.length === 0) {
          if (gameState.stock.length > 0) {
            showHintTooltip('No tienes fichas jugables. Debes robar.', 'info', 3000)
          } else {
            showHintTooltip('No tienes fichas jugables. Debes pasar.', 'info', 3000)
          }
        } else {
          showHintTooltip(`Tienes ${playableTiles.length} ficha${playableTiles.length > 1 ? 's' : ''} jugable${playableTiles.length > 1 ? 's' : ''}`, 'success', 3000)
          highlightPlayableTiles()

          setTimeout(() => {
            document.querySelectorAll('.tile-wrapper').forEach(tile => {
              tile.classList.remove('highlighted')
            })
          }, 3000)
        }
      }

      // Iniciar nueva partida
      function handleNewGame() {
        if (gameInterval) clearInterval(gameInterval)

        initGame({
          tilesPerPlayer: 7,
          startingPlayer: 'random',
          enableHints: true
        })

        showMessage('¬°Nueva partida!', 'success')
        updateUI()

        const gameState = getGameState()
        if (gameState?.currentPlayer === 'opponent') {
          setTimeout(() => {
            aiPlay()
            updateUI()
          }, 1500)
        }

        gameInterval = setInterval(updateGameState, 1000)
      }

      // Reiniciar completamente
      function handleResetGame() {
        if (confirm('¬øReiniciar todo el juego?')) {
          handleNewGame()
        }
      }

      // Cambiar dificultad de IA
      function handleDifficultyChange(difficulty) {
        changeAIDifficulty(difficulty)
        showMessage(`Dificultad cambiada a: ${difficulty === 'easy' ? 'F√°cil' : difficulty === 'medium' ? 'Medio' : 'Dif√≠cil'}`, 'info')
      }

      // Actualizar estado del juego
      function updateGameState() {
        const gameState = getGameState()
        if (!gameState) return

        if (gameState.phase === 'playing') {
          updateUI()

          // Actualizar contadores
          const playerCount = document.getElementById('playerCount')
          const opponentCount = document.getElementById('opponentCount')
          const boardCount = document.getElementById('boardCount')
          const stockCount = document.getElementById('stockCount')
          const turnIndicator = document.getElementById('turnIndicator')
          const roundNumber = document.getElementById('roundNumber')

          if (playerCount) playerCount.textContent = `${gameState.playerHand.length} fichas`
          if (opponentCount) opponentCount.textContent = `${gameState.opponentHand.length} fichas`
          if (boardCount) boardCount.textContent = `${gameState.board.tiles.length} fichas`
          if (stockCount) stockCount.textContent = gameState.stock.length
          if (roundNumber) roundNumber.textContent = gameState.round || 1

          if (turnIndicator) {
            turnIndicator.textContent =
              gameState.currentPlayer === 'player' ? 'Turno: Jugador' : 'Turno: IA'
          }
        } else if (gameState.phase === 'finished') {
          // Juego terminado, reproducir sonido apropiado
          if (gameState.winner === 'player') {
            audioManager?.playSFX('win')
            // Lanzar confetti para victoria del jugador
            setTimeout(() => launchConfetti(4000), 300)
          } else if (gameState.winner === 'opponent') {
            audioManager?.playSFX('lose')
          } else if (gameState.isBlocked) {
            audioManager?.playSFX('blocked')
          }

          // Guardar puntuaciones
          saveScores(gameState.playerWins, gameState.opponentWins)
          updateUI()

          // Mostrar modal de resultado con un peque√±o delay
          setTimeout(() => {
            if (gameState.isBlocked) {
              // Modal de juego bloqueado
              const playerPoints = gameState.playerHand.reduce((sum, tile) => sum + tile.a + tile.b, 0)
              const opponentPoints = gameState.opponentHand.reduce((sum, tile) => sum + tile.a + tile.b, 0)
              showBlockedModal({
                playerPoints,
                opponentPoints
              })
            } else {
              // Modal de victoria normal
              showVictoryModal(gameState.winner, {
                playerScore: gameState.playerWins,
                opponentScore: gameState.opponentWins
              })
            }
          }, 500)
        }
      }

      // Guardar puntuaciones en localStorage
      function saveScores(playerWins, opponentWins) {
        try {
          const scores = {
            playerWins: playerWins || 0,
            opponentWins: opponentWins || 0,
            lastUpdated: new Date().toISOString()
          }
          localStorage.setItem('domino_scores', JSON.stringify(scores))
          console.log('üíæ Puntuaciones guardadas')
        } catch (e) {
          console.warn('‚ö†Ô∏è Error guardando puntuaciones:', e)
        }
      }

      // Cargar puntuaciones desde localStorage
      function loadScores() {
        try {
          const scores = localStorage.getItem('domino_scores')
          if (scores) {
            const parsed = JSON.parse(scores)
            console.log('üìä Puntuaciones cargadas:', parsed)
            return parsed
          }
        } catch (e) {
          console.warn('‚ö†Ô∏è Error cargando puntuaciones:', e)
        }
        return { playerWins: 0, opponentWins: 0 }
      }

      // Limpiar al salir
      window.addEventListener('beforeunload', () => {
        if (gameInterval) clearInterval(gameInterval)
      })

      // Exponer funciones para debugging
      window.dominoGame = {
        getGameState,
        handleTileClick,
        handleDrawTile,
        handleNewGame,
        updateUI
      }
    </script>
  </body>
</html>
